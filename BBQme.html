<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <style>
        
        html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: teal;
        }

        .wrapper {
        text-align: center;
        }

        .button {
        position: absolute;
        top: 50%;
        }

        .big{
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: yellow;
            font-weight: bold;
        }

        .title{
            font-size: x-large;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif  ;
            color: yellow;
            
        } 
        
        .weathers{
            font-size: larger;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
            color: aqua;
            font-weight: bold;
            

        }
        
        .buttons{
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ;
            color: teal;
            background-color: black,
        }
            
    
        
     </style>
    <title>Best Day for a BBQ</title>
</head>
<body>
    <h1 class = 'big'>Best Day for a BBQ üçîüòã</h1>
    <h2 class = 'title' >Enter the City you are in and we will tell you the best day for a BBQ this weekü§î</h2>
    <div class="wrapper">
        <input type="text" placeholder="Enter Your City Here" class="buttons" id = 'yourcity'>
        <button class="buttons" id = 'go'><i class="go-btn"></i>Go!</button>
    </div>
    <div class = "row"></div>
        <div class="column">
        <h3 id = 'loading' class = 'title'></h3>
                <p class = 'weathers' id = 'w1' title = 'weather_1'></p>
                <p class = 'weathers' id = 'w2' title = 'weather_2' ></p>
                <p class = 'weathers' id = 'w3' title = 'weather_3'></p>
                <p class = 'weathers' id = 'w4' title = 'weather_4'></p>  
    </div>
    <script>
//setup DOM Strings
const DOMStrings = {
    inputLeft: document.getElementById('yourcity'),
    topBarLeft: document.getElementById('loading'),
    gobtn: document.getElementById('go'),
    weatherInfo1L: document.getElementById('w1'),
    weatherInfo2L: document.getElementById('w2'),
    weatherInfo3L: document.getElementById('w3'),
    weatherInfo4L: document.getElementById('w4'),

}



//Find WOE ID (Where On Earth ID) for the location input by user
async function getlocationAW(query) {
    console.log('starting location request')
    try {
        let result = await fetch(`https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/search/?query=${query}`)
        let location = await result.json()
        console.log(location)
        let ID = location[0].woeid
        console.log(ID)
        return ID

    } catch (error) {
        console.log(error)
        failed()
    }
}

//fetch weather data and setup data structure
async function getweatherAW(woeID) {

    try {
        let result = await fetch(`https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/${woeID}/`)
        let data = await result.json()
        console.log('got result')

        //Get Sky & Temp for our 6 days
        let day0 = [data.consolidated_weather[0].weather_state_name, data.consolidated_weather[0].the_temp, data.consolidated_weather[0].applicable_date]
        let day1 = [data.consolidated_weather[1].weather_state_name, data.consolidated_weather[1].the_temp, data.consolidated_weather[1].applicable_date]
        let day2 = [data.consolidated_weather[2].weather_state_name, data.consolidated_weather[2].the_temp, data.consolidated_weather[2].applicable_date]
        let day3 = [data.consolidated_weather[3].weather_state_name, data.consolidated_weather[3].the_temp, data.consolidated_weather[3].applicable_date]
        let day4 = [data.consolidated_weather[4].weather_state_name, data.consolidated_weather[4].the_temp, data.consolidated_weather[4].applicable_date]
        let day5 = [data.consolidated_weather[5].weather_state_name, data.consolidated_weather[5].the_temp, data.consolidated_weather[5].applicable_date]
        

        //Put the above into an Array
        let weatherStates = [
            day0,
            day1,
            day2,
            day3,
            day4,
            day5
        ]
        return weatherStates

    } catch (error) {
        failed()
        console.log(error)
    }
}

// clears all of out HTML
clear = () => {
    DOMStrings.topBarLeft.textContent = ''
    DOMStrings.weatherInfo1L.textContent = ''
    DOMStrings.weatherInfo2L.textContent = ''
    DOMStrings.weatherInfo3L.textContent = ''
    DOMStrings.weatherInfo4L.textContent = ''
}

//If the fetch fails, notify user
failed = () => {
    DOMStrings.topBarLeft.textContent = 'Sorry fetch request failed, please try again later üò•'
    DOMStrings.weatherInfo1L.textContent = 'Maybe take a look at the spelling of your City üèôÔ∏è'
    DOMStrings.weatherInfo2L.textContent = 'If Your City isn\'t big enough there may not be data üì°'
    DOMStrings.weatherInfo3L.textContent = ''
    DOMStrings.weatherInfo4L.textContent = ''
}


// let the user know our app is doing something 
loading = () => {
    DOMStrings.topBarLeft.textContent = 'Fetching Weather data... üõ∞Ô∏è'
    DOMStrings.weatherInfo1L.textContent = 'Searching up at the sky... üî≠'
    DOMStrings.weatherInfo2L.textContent = 'Putting a finger to the wind... üçÉ'
    DOMStrings.weatherInfo3L.textContent = ''
    DOMStrings.weatherInfo4L.textContent = ''
}

// display results of our best day to the UI
outputBestDay = (skyState) => {
    if(skyState !== 'noBBQ') {
    DOMStrings.topBarLeft.textContent = `The best day for a BBQ in ${DOMStrings.inputLeft.value} this week is ${skyState[2]}üçî`
    DOMStrings.weatherInfo1L.textContent = `It will be ${skyState[1].toFixed(2)}C üå°Ô∏è`
    if (skyState.includes('Clear')) {DOMStrings.weatherInfo2L.textContent = `The sky will be ${skyState[0]}üåû`
    } else if (skyState.includes('Light Cloud')) {DOMStrings.weatherInfo2L.textContent = `There will be ${skyState[0]}üå§Ô∏è`}
    DOMStrings.weatherInfo3L.textContent = ''
    DOMStrings.weatherInfo4L.textContent = ''
    } else {
    DOMStrings.topBarLeft.textContent = `Sorry there are no good days for a BBQ in ${DOMStrings.inputLeft.value}‚òî`
    DOMStrings.weatherInfo1L.textContent = `Come back in a few days and try againüëã`
    DOMStrings.weatherInfo2L.textContent = `The sun will be back soon üòé`
    DOMStrings.weatherInfo3L.textContent = ''
    DOMStrings.weatherInfo4L.textContent = ''

    }

}

//find best day for a BBQ
action = async () => {
    clear()
    var input1 = DOMStrings.inputLeft.value;
    console.log(input1)
    loading()
    //get WOE ID from API
    ID1 = await getlocationAW(input1)
    //get Weather for that WOE ID
    temp_Sky = await getweatherAW(ID1)
    console.log(temp_Sky)

    //If temp_Sky entries include Clear or light cloud put them into seperate arrays 
    clearDays = []
    lightCloudDays = []
    temp_Sky.forEach(element => {
        if (element.includes('Clear')) {
            clearDays.push(element)
        } else if (element.includes('Light Cloud')) {
            lightCloudDays.push(element)
        }
    });
    console.log(clearDays)
    console.log(lightCloudDays)
    //put clear days into an array
    allClearDays = [].concat(...clearDays)
    console.log(allClearDays)
    //put light cloud days into an array
    allLightCloudDays = [].concat(...lightCloudDays)
    console.log(allLightCloudDays)
    //pull down into temps arrays


    //Clear Temps 
    clearTemps = []
    allClearDays.forEach(el => {
        if (typeof(el) === 'number') {
            clearTemps.push(el)
        }
    })
    console.log(clearTemps)
    //Light Cloud Temps
    lightCloudTemps = []
    allLightCloudDays.forEach(el => {
        if (typeof(el) === 'number') {
            lightCloudTemps.push(el)
        }
    })
    console.log(lightCloudTemps)

    //find highest temp in each
    highestClearTemp = Math.max(...clearTemps)
    highestLightCloudTemp = Math.max(...lightCloudTemps)

    console.log(highestClearTemp)
    console.log(highestLightCloudTemp)


    //output highest temp clear day
    let bestClearDay, bestLightCloudDay
    temp_Sky.forEach(element => {
        if (element.includes('Clear') && element.includes(highestClearTemp)) {
            bestClearDay = element
        } else if (element.includes('Light Cloud') && element.includes(highestLightCloudTemp)) {
            bestLightCloudDay = element
        }
    });
    console.log(bestClearDay, bestLightCloudDay)

    //output best clear day
    if (bestClearDay) {

      outputBestDay(bestClearDay)
    } //if that doesn't exist then output highest light cloud day  
    else if (!bestClearDay && bestLightCloudDay) {

        outputBestDay(bestLightCloudDay)
    } //if neither exist then output a sorry message
    else {
       outputBestDay('noBBQ')
    }

    

}
//running action() on click
DOMStrings.gobtn.addEventListener('click', () => {
    action()
})
//running action() on enter press
document.addEventListener('keypress', (event) => {
    if (event.keyCode === 13 || event.which === 13) {
        action()
    }
})
</script>
</body>
</html>
